# AGV ì œì–´ ì‹œìŠ¤í…œ ê°œë°œ ë¡œê·¸

> **ì‘ì„±ì¼**: 2025-11-13  
> **í”„ë¡œì íŠ¸**: RF-Tag ê¸°ë°˜ AGV ë¼ì¸ íŠ¸ë ˆì´ì‹± ì‹œìŠ¤í…œ

---

## ğŸ“‹ ëª©ì°¨
1. [ì´ˆê¸° ë¬¸ì œì ](#ì´ˆê¸°-ë¬¸ì œì )
2. [ê°œì„  ì‘ì—… ë‚´ì—­](#ê°œì„ -ì‘ì—…-ë‚´ì—­)
3. [í˜„ì¬ ì‹œìŠ¤í…œ êµ¬ì¡°](#í˜„ì¬-ì‹œìŠ¤í…œ-êµ¬ì¡°)
4. [ì£¼ìš” ê¸°ëŠ¥](#ì£¼ìš”-ê¸°ëŠ¥)
5. [ì„¤ì • íŒŒë¼ë¯¸í„°](#ì„¤ì •-íŒŒë¼ë¯¸í„°)
6. [ì•Œë ¤ì§„ ì´ìŠˆ](#ì•Œë ¤ì§„-ì´ìŠˆ)
7. [í–¥í›„ ê°œì„  ê³„íš](#í–¥í›„-ê°œì„ -ê³„íš)

---

## ğŸš¨ ì´ˆê¸° ë¬¸ì œì 

### 1. ë¼ì¸ íŠ¸ë ˆì´ì‹± ë¬¸ì œ
- **ë¬¸ì œ**: ì™¼ìª½ ì»¤ë¸Œì—ì„œ ë¼ì¸ì„ ìƒì–´ë²„ë¦¼
- **ì›ì¸**: Sharp turn ì„ê³„ê°’ì´ ë„ˆë¬´ ë‚®ìŒ (8)
- **í•´ê²°**: ì„ê³„ê°’ì„ 12ë¡œ ìƒí–¥ ì¡°ì •

### 2. ì›¹ AGV íšŒì „ ë°©í–¥ ì˜¤ë¥˜
- **ë¬¸ì œ**: Tag 3 ì§€ì ì—ì„œ 270Â° ìš°íšŒì „ (ì‹¤ì œëŠ” 90Â° ì¢ŒíšŒì „)
- **ì›ì¸**: ê°ë„ ì •ê·œí™” ì—†ì´ ì ˆëŒ€ ê°ë„ë¡œ íšŒì „
- **í•´ê²°**: ìµœë‹¨ ê²½ë¡œ íšŒì „ (-180Â° ~ 180Â° ì •ê·œí™”)

### 3. EStop ìƒíƒœ ë¯¸í‘œì‹œ
- **ë¬¸ì œ**: OBS-EStop ë°œìƒ ì‹œ AGV ìƒíƒœê°€ "Running"ìœ¼ë¡œ ìœ ì§€
- **ì›ì¸**: `estop_status` í•„ë“œê°€ `agv_data["status"]`ì— ë§¤í•‘ ì•ˆ ë¨
- **í•´ê²°**: `/update` ì—”ë“œí¬ì¸íŠ¸ì—ì„œ EStop ìƒíƒœ ìš°ì„  í‘œì‹œ

### 4. Tag 4-7 êµ¬ê°„ ì´ìƒ ë™ì‘
- **ë¬¸ì œ**: 
  - Tag 4ì—ì„œ ì´ìœ  ì—†ì´ ì •ì§€
  - Tag 5ì—ì„œ ì˜ëª»ëœ ë°©í–¥ìœ¼ë¡œ íšŒì „
- **ì›ì¸**: Mission Planningì´ ì§ì ‘ ëª¨í„° ì œì–´ (ë¼ì¸ íŠ¸ë ˆì´ì‹±ê³¼ ì¶©ëŒ)
- **í•´ê²°**: Mission Planningì„ ì½œë°± ê¸°ë°˜ìœ¼ë¡œ ì¬ì„¤ê³„

### 5. ì†ë„ ì œì–´ ë¡œì§ ì˜¤ë¥˜
- **ë¬¸ì œ**: Tag 2 ì†ë„ë¥¼ ê³ ì • ì†ë„ë¡œ ì‚¬ìš©
- **ì›ì¸**: `speed = tag2_speed` (ê³ ì •ê°’)
- **í•´ê²°**: `max_speed = min(tag2_speed, mission_max_speed)` (ìµœëŒ€ ì œí•œê°’)

### 6. ê³¼ë„í•œ ì¡°í–¥ ë³´ì •
- **ë¬¸ì œ**: ë‚®ì€ ì†ë„ì—ì„œ ì¡°í–¥ ë³´ì • ì‹œ ì •ì§€
- **ì›ì¸**: ê³ ì •ëœ correction ê°’ ì‚¬ìš©
- **í•´ê²°**: ì†ë„ì˜ 30% ì´ë‚´ë¡œ correction ì œí•œ

---

## ğŸ”§ ê°œì„  ì‘ì—… ë‚´ì—­

### Phase 1: ê¸°ë³¸ ì£¼í–‰ ì•ˆì •í™”
**ë‚ ì§œ**: 2025-11-13 (ì˜¤ì „)

#### 1.1 Sharp Turn ì„ê³„ê°’ ì¡°ì •
```python
# Before
if abs(line_pos) > 8:

# After  
if abs(line_pos) > 12:
```
- ì™¼ìª½ ì»¤ë¸Œ êµ¬ê°„ì—ì„œ ë¼ì¸ íŠ¸ë ˆì´ì‹± ì„±ê³µë¥  í–¥ìƒ

#### 1.2 ì›¹ AGV ê°ë„ ì •ê·œí™”
```javascript
// ìµœë‹¨ ê²½ë¡œ íšŒì „ ë¡œì§
let angleDiff = targetAngle - agvAnimAngle;
while (angleDiff > 180) angleDiff -= 360;
while (angleDiff < -180) angleDiff += 360;
agvAnimAngle += angleDiff;
```
- 270Â° ìš°íšŒì „ â†’ 90Â° ì¢ŒíšŒì „ìœ¼ë¡œ ê°œì„ 

#### 1.3 ëª¨ë“  íšŒì „ ì§€ì  ê²€ì¦
- Tag 1â†’2: 90Â° ì¢ŒíšŒì „ âœ…
- Tag 2â†’3: 90Â° ì¢ŒíšŒì „ âœ…
- Tag 3â†’4: 90Â° ì¢ŒíšŒì „ âœ…
- Tag 4â†’5: 90Â° ì¢ŒíšŒì „ âœ…
- Tag 5â†’6: 90Â° ì¢ŒíšŒì „ âœ…
- Tag 6â†’7: 90Â° ì¢ŒíšŒì „ âœ…
- Tag 7â†’8: 90Â° ì¢ŒíšŒì „ âœ…
- Tag 8â†’9: 90Â° ì¢ŒíšŒì „ âœ…
- Tag 9â†’10: 90Â° ì¢ŒíšŒì „ âœ…

---

### Phase 2: EStop ì²˜ë¦¬ ê°œì„ 
**ë‚ ì§œ**: 2025-11-13 (ì˜¤í›„ ì´ˆë°˜)

#### 2.1 EStop ìƒíƒœ ë§¤í•‘
```python
# agv_station_server.py
if "estop_status" in data:
    agv_data["estop_status"] = data["estop_status"]
    if data["estop_status"]:
        agv_data["status"] = data["estop_status"]

if not agv_data.get("estop_status"):
    agv_data["status"] = get_state_name(current_agv_state)
```

#### 2.2 ëª¨ë“  EStop íƒ€ì… ê²€ì¦
| EStop íƒ€ì… | ê°ì§€ | í‘œì‹œ | ìë™ ë³µêµ¬ | ìƒíƒœ ì „í™˜ |
|-----------|------|------|----------|----------|
| **Push-EStop** | âœ… EmgFlag=1 | âœ… "Push-EStop" | âœ… ë²„íŠ¼ í•´ì œ ì‹œ | â†’ PAUSED |
| **OBS-EStop** | âœ… LiDAR<150mm | âœ… "OBS-EStop" | âœ… ì¥ì• ë¬¼ ì œê±° 2ì´ˆ í›„ | â†’ RUNNING |
| **SRV-EStop** | âœ… E-Stop ë²„íŠ¼ | âœ… "SRV-EStop" | âŒ ìˆ˜ë™ Resume í•„ìš” | â†’ PAUSED |

---

### Phase 3: ì†ë„ ì œì–´ ìµœì í™”
**ë‚ ì§œ**: 2025-11-13 (ì˜¤í›„ ì¤‘ë°˜)

#### 3.1 ì†ë„ ì œì–´ ì•Œê³ ë¦¬ì¦˜ ê°œì„ 
```python
# Before (ì˜ëª»ëœ ë¡œì§)
speed = tag2_speed  # ê³ ì • ì†ë„

# After (ì˜¬ë°”ë¥¸ ë¡œì§)
base_speed = 150  # ê¸°ë³¸ ì£¼í–‰ ì†ë„
max_speed = min(tag2_speed, mission_max_speed)  # ìµœëŒ€ ì œí•œ
effective_speed = min(base_speed, max_speed)  # ì‹¤ì œ ì ìš©
```

#### 3.2 ì¡°í–¥ ë³´ì • ì œí•œ
```python
# Before
correction = int(abs(line_pos) * 8)

# After
max_correction = int(effective_speed * 0.3)  # ì†ë„ì˜ 30%
correction = min(int(abs(line_pos) * 8), max_correction)
```
- ë‚®ì€ ì†ë„ì—ì„œë„ ì •ì§€í•˜ì§€ ì•ŠìŒ

#### 3.3 Tag 4 ì†ë„ ì¡°ì •
```python
# agv_station_server.py
4: {'x': 680, 'y': 248, 'speed_limit': 150}  # 120 â†’ 150
```
- ê¸‰íšŒì „ êµ¬ê°„ì—ì„œ ì•ˆì •ì„± í™•ë³´

---

### Phase 4: Mission Planning ì¬ì„¤ê³„
**ë‚ ì§œ**: 2025-11-13 (ì˜¤í›„ í›„ë°˜)

#### 4.1 ë¬¸ì œ ë¶„ì„
```python
# ì˜ëª»ëœ ë°©ì‹ (ì§ì ‘ ëª¨í„° ì œì–´)
def execute_mission(tag_id, agv_comm, tag2_speed):
    if tag_id == 4:
        agv_comm.CLR(0, 0)  # âŒ ë¼ì¸ íŠ¸ë ˆì´ì‹±ê³¼ ì¶©ëŒ!
        time.sleep(2)
        agv_comm.CLR(150, 150)
```

#### 4.2 ì½œë°± ê¸°ë°˜ ì„¤ê³„
```python
# ì˜¬ë°”ë¥¸ ë°©ì‹ (ì½œë°± ì‚¬ìš©)
def execute_mission(tag_id, agv_comm, tag2_speed):
    if tag_id == 10:
        pause_line_tracing()  # âœ… ì½œë°±ìœ¼ë¡œ ì œì–´
        return {"status": "completed", "action": "pause", "speed": 0}
    
    # ë¼ì¸ íŠ¸ë ˆì´ì‹± ê³„ì†
    set_max_speed(tag2_speed)
    return {"status": "success", "action": "continue"}
```

#### 4.3 Mission Planning API
```python
# ì œê³µë˜ëŠ” í•¨ìˆ˜ë“¤
pause_line_tracing()      # ë¼ì¸ íŠ¸ë ˆì´ì‹± ì¤‘ë‹¨
resume_line_tracing()     # ë¼ì¸ íŠ¸ë ˆì´ì‹± ì¬ê°œ
set_max_speed(speed)      # ìµœëŒ€ ì†ë„ ì„¤ì • (50~200 mm/s)
```

---

### Phase 5: ë””ë²„ê¹… ë„êµ¬ ì¶”ê°€
**ë‚ ì§œ**: 2025-11-13 (ì €ë…)

#### 5.1 Curses ë””ë²„ê·¸ ë””ìŠ¤í”Œë ˆì´
```python
USE_CURSES = False  # ê¸°ë³¸ê°’: ë¹„í™œì„±í™” (ë¶€í•˜ ë°©ì§€)

def update_debug_display():
    # 0.5ì´ˆë§ˆë‹¤ë§Œ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
    if now - last_display_update < 0.5:
        return
```

**í‘œì‹œ ì •ë³´**:
- ì„¼ì„œ ë°ì´í„° (Line Position, LiDAR, Battery)
- RF-Tag ì •ë³´ (Current Tag, Speed Limit)
- ì œì–´ ìƒíƒœ (Line Following, E-Stop, Obstacle)
- ëª¨í„° ì¶œë ¥ (Left/Right Wheel)

---

### Phase 6: ì›¹ AGV ë™ê¸°í™”
**ë‚ ì§œ**: 2025-11-13 (ë°¤)

#### 6.1 ë¬¸ì œì 
1. Tag 10ì—ì„œ `pause_line_tracing()` í˜¸ì¶œ ì‹œ ì›¹ AGV ê³„ì† ì›€ì§ì„
2. ì í”„/ëŒ€ê¸° ë¡œì§ ì‘ë™ ì•ˆ í•¨
3. Tag 10 ì´í›„ ì´ˆê¸°ê°’ìœ¼ë¡œ ë˜ëŒì•„ê°

#### 6.2 í•´ê²°ì±…

##### 6.2.1 ë¼ì¸ íŠ¸ë ˆì´ì‹± ìƒíƒœ ì „ì†¡
```python
# agv_control_client_simple.py
payload = {
    "is_line_following": is_line_following,  # ì¶”ê°€
    # ... ê¸°íƒ€ ë°ì´í„°
}
```

```javascript
// templates/index.html
if (data.is_line_following === false) {
    isAnimating = false;
    console.log('â¸ï¸ ë¼ì¸ íŠ¸ë ˆì´ì‹± ì¤‘ë‹¨ â†’ ì• ë‹ˆë©”ì´ì…˜ ì •ì§€');
}
```

##### 6.2.2 Tag 10 ì´í›„ ì´ˆê¸°í™” ë°©ì§€
```javascript
if (stateUpper === 'READY' || stateUpper === 'INITIAL') {
    isAnimating = false;
    if (lastDetectedTagId < 10) {
        // Tag 10 ë¯¸ë§Œ: ì´ˆê¸°í™”
        agvAnimPosition = { x: 1491, y: 620 };
        // ...
    } else {
        // Tag 10 ì´ìƒ: ìœ„ì¹˜ ìœ ì§€
        console.log('ğŸ Tag 10 ì™„ë£Œ - ìœ„ì¹˜ ìœ ì§€');
    }
}
```

##### 6.2.3 ì„¼ì„œ íƒœê·¸ ê¸°ë°˜ ë™ê¸°í™”
```javascript
// í•µì‹¬ ë¡œì§
const sensorTagId = parseInt(data.current_tag);
const currentServerTag = lastDetectedTagId || 0;

if (sensorTagId > currentServerTag) {
    // ì„¼ì„œê°€ ì•ì„œê° â†’ ì í”„
    resetAGVToTagPosition(sensorTagId, tagPos.x, tagPos.y);
    isAnimating = true;
} else if (sensorTagId < currentServerTag) {
    // ì„œë²„ê°€ ì•ì„œê° â†’ ëŒ€ê¸°
    waitingForTag = true;
    isAnimating = false;
} else {
    // ë™ì¼ â†’ ëŒ€ê¸° í•´ì œ
    if (waitingForTag) {
        waitingForTag = false;
        isAnimating = true;
    }
}
```

**ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸**:
- ì´ˆê¸° (Tag 0): ì„œë²„ AGV ì •ì§€
- ì„¼ì„œ Tag 1 â†’ ì„œë²„ AGV ì í”„ + ì‹œì‘
- ì„œë²„ Tag 2 ë„ì°©, ì„¼ì„œ Tag 1 â†’ ì„œë²„ AGV ëŒ€ê¸°
- ì„¼ì„œ Tag 2 ë„ì°© â†’ ëŒ€ê¸° í•´ì œ + ê³„ì† ì§„í–‰
- ì„¼ì„œê°€ ë¨¼ì € Tag 3 â†’ ì„œë²„ AGV ì í”„

---

### Phase 7: ìµœì¢… ìµœì í™”
**ë‚ ì§œ**: 2025-11-13 (ìµœì¢…)

#### 7.1 Mission Max Speed ì œì–´
```python
# agv_control_client_simple.py
mission_max_speed = 200  # Mission Planningì—ì„œ ì¡°ì • ê°€ëŠ¥

def set_mission_max_speed(speed):
    global mission_max_speed
    mission_max_speed = max(50, min(speed, 200))
```

```python
# mission_planning.py
def execute_mission(tag_id, agv_comm, tag2_speed):
    if tag_id == 5:
        set_max_speed(120)  # Tag 5ì—ì„œ ì†ë„ ì œí•œ
```

#### 7.2 ì›¹ ì• ë‹ˆë©”ì´ì…˜ ì†ë„ ì¡°ì •
```javascript
// templates/index.html
const CONFIG = {
    AGV_ANIMATION_SPEED_BASE: 3.0,  // 1.5 â†’ 3.0 (2ë°°)
    TAG_ARRIVAL_THRESHOLD: 50,
    WAIT_AT_TAG: true
};

// ì†ë„ ë¹„ë¡€ ê³„ì‚°
const speedRatio = currentSpeedLimit / 200.0;
const currentAnimSpeed = CONFIG.AGV_ANIMATION_SPEED_BASE * speedRatio;
```

**ì†ë„ë³„ ì• ë‹ˆë©”ì´ì…˜**:
- 200mm/s â†’ 3.0 í”½ì…€/í”„ë ˆì„
- 100mm/s â†’ 1.5 í”½ì…€/í”„ë ˆì„
- 50mm/s â†’ 0.75 í”½ì…€/í”„ë ˆì„

#### 7.3 handleAGVStateChange ê°œì„ 
```javascript
if (stateUpper === 'RUNNING' || stateUpper === 'RESUME') {
    if (!waitingForTag) {  // ëŒ€ê¸° ì¤‘ì´ ì•„ë‹ ë•Œë§Œ
        isAnimating = true;
    }
    console.log(`â–¶ï¸ AGV RUNNING (ëŒ€ê¸° ì¤‘: ${waitingForTag})`);
}
```

---

## ğŸ—ï¸ í˜„ì¬ ì‹œìŠ¤í…œ êµ¬ì¡°

### ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì›¹ ë¸Œë¼ìš°ì € (Port 5000)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           ì›¹ ëŒ€ì‹œë³´ë“œ (index.html)                   â”‚    â”‚
â”‚  â”‚  - ì‹¤ì‹œê°„ AGV ìœ„ì¹˜ í‘œì‹œ                             â”‚    â”‚
â”‚  â”‚  - ì›¹ AGV ì• ë‹ˆë©”ì´ì…˜ (ì„¼ì„œ íƒœê·¸ ë™ê¸°í™”)             â”‚    â”‚
â”‚  â”‚  - ì œì–´ ë²„íŠ¼ (GO/PAUSE/STOP/E-STOP)                â”‚    â”‚
â”‚  â”‚  - ì„¼ì„œ ë°ì´í„° í‘œì‹œ                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP (POST /update, GET /tag_nums)
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ì„œë²„ (agv_station_server.py)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  State Machine (AGVStateMachine)                    â”‚    â”‚
â”‚  â”‚  States:                                            â”‚    â”‚
â”‚  â”‚   - INITIAL â†’ READY â†’ RUNNING â†’ PAUSED â†’ COMPLETED â”‚    â”‚
â”‚  â”‚   - E-Stop States: Push/OBS/SRV-EStop              â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  Endpoints:                                         â”‚    â”‚
â”‚  â”‚   - GET  /        : ì›¹ ëŒ€ì‹œë³´ë“œ                    â”‚    â”‚
â”‚  â”‚   - POST /update  : ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹                â”‚    â”‚
â”‚  â”‚   - POST /command : ì œì–´ ëª…ë ¹ ìˆ˜ì‹                  â”‚    â”‚
â”‚  â”‚   - GET  /tag_nums: íƒœê·¸ ìœ„ì¹˜ ì •ë³´                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP (POST /start, /stop, /pause, etc.)
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          í´ë¼ì´ì–¸íŠ¸ (agv_control_client_simple.py)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ì£¼ìš” ê¸°ëŠ¥:                                         â”‚    â”‚
â”‚  â”‚   1. ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘ (0.1ì´ˆ ì£¼ê¸°)                 â”‚    â”‚
â”‚  â”‚   2. ë¼ì¸ íŠ¸ë ˆì´ì‹± ì œì–´                            â”‚    â”‚
â”‚  â”‚   3. ì¥ì• ë¬¼ ê°ì§€ ë° ë³µêµ¬                           â”‚    â”‚
â”‚  â”‚   4. Mission Planning ì‹¤í–‰                         â”‚    â”‚
â”‚  â”‚   5. ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡                            â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  Flask Server (Port 5001):                         â”‚    â”‚
â”‚  â”‚   - POST /start            : ë¼ì¸ íŠ¸ë ˆì´ì‹± ì‹œì‘    â”‚    â”‚
â”‚  â”‚   - POST /stop             : ëª¨í„° ì •ì§€             â”‚    â”‚
â”‚  â”‚   - POST /pause            : ì¼ì‹œì •ì§€              â”‚    â”‚
â”‚  â”‚   - POST /estop            : ë¹„ìƒì •ì§€              â”‚    â”‚
â”‚  â”‚   - GET  /health_check     : ìƒíƒœ ì ê²€             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ Callback Interface
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Mission Planning (mission_planning.py)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  íƒœê·¸ë³„ ì„ë¬´ ì •ì˜:                                  â”‚    â”‚
â”‚  â”‚   - Tag 0  : ì´ˆê¸° ìƒíƒœ (200mm/s)                  â”‚    â”‚
â”‚  â”‚   - Tag 1  : ì‹œì‘ì                                 â”‚    â”‚
â”‚  â”‚   - Tag 2-9: ì„ë¬´ êµ¬ì—­ (ì‚¬ìš©ì ì •ì˜)              â”‚    â”‚
â”‚  â”‚   - Tag 10 : ëª©ì ì§€ (ì •ì§€)                        â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  ì œê³µ API:                                          â”‚    â”‚
â”‚  â”‚   - pause_line_tracing()   : ì¤‘ë‹¨                  â”‚    â”‚
â”‚  â”‚   - resume_line_tracing()  : ì¬ê°œ                  â”‚    â”‚
â”‚  â”‚   - set_max_speed(speed)   : ì†ë„ ì„¤ì •            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ Serial Communication (115200 baud)
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 í•˜ë“œì›¨ì–´ (Donkibot_i.py)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ì„¼ì„œ:                                              â”‚    â”‚
â”‚  â”‚   - Line Position  : ë¼ì¸ ìœ„ì¹˜ (-127 ~ 127)       â”‚    â”‚
â”‚  â”‚   - LiDAR Distance : ì¥ì• ë¬¼ ê±°ë¦¬ (mm)             â”‚    â”‚
â”‚  â”‚   - RF-Tag1        : íƒœê·¸ ID (0-10)               â”‚    â”‚
â”‚  â”‚   - RF-Tag2        : ì†ë„ ì œí•œ (0-200 mm/s)       â”‚    â”‚
â”‚  â”‚   - EmgFlag        : ë¹„ìƒì •ì§€ ë²„íŠ¼                 â”‚    â”‚
â”‚  â”‚   - SOC            : ë°°í„°ë¦¬ ì”ëŸ‰ (%)               â”‚    â”‚
â”‚  â”‚   - TfsAngle       : íšŒì „ ê°ë„ (0-359Â°)           â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  ì•¡ì¶”ì—ì´í„°:                                        â”‚    â”‚
â”‚  â”‚   - CLR(vl, vr)    : ì¢Œìš° ë°”í€´ ì†ë„ ì œì–´          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ ì£¼ìš” ê¸°ëŠ¥

### 1. ë¼ì¸ íŠ¸ë ˆì´ì‹±
**íŒŒì¼**: `agv_control_client_simple.py`

```python
def line_following_control():
    # Tag 1 ì´ì „: 200mm/s ê³ ì •
    if current_tag == 0:
        effective_speed = 200
    # Tag 1 ì´í›„: tag2ì™€ mission_max_speed ê¸°ì¤€
    else:
        base_speed = 150
        max_speed = min(tag2_speed, mission_max_speed)
        effective_speed = min(base_speed, max_speed)
    
    # Sharp Turn (|line_pos| > 12)
    if abs(line_pos) > 12:
        vl, vr = (-50, 50) if line_pos < 0 else (50, -50)
    
    # ë¯¸ì„¸ ì¡°ì • (correction â‰¤ 30% of speed)
    else:
        max_correction = int(effective_speed * 0.3)
        correction = min(int(abs(line_pos) * 8), max_correction)
        # ...
```

**íŠ¹ì§•**:
- Tag ê¸°ë°˜ ì†ë„ ì œì–´
- ì¡°í–¥ ë³´ì • ì œí•œ (ì •ì§€ ë°©ì§€)
- Sharp turn ê°ì§€ (Spot turn)

---

### 2. ì¥ì• ë¬¼ ê°ì§€ ë° ë³µêµ¬
**íŒŒì¼**: `agv_control_client_simple.py`

```python
OBSTACLE_THRESHOLD = 150          # ê¸´ê¸‰ì •ì§€ ì„ê³„ê°’ (mm)
OBSTACLE_RECOVERY_THRESHOLD = 300 # ë³µêµ¬ ì„ê³„ê°’ (mm)
OBSTACLE_RECOVERY_TIME = 2.0      # ë³µêµ¬ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)

def check_obstacle():
    if lidar_dist < OBSTACLE_THRESHOLD:
        # ì¥ì• ë¬¼ ê°ì§€ â†’ ê¸´ê¸‰ì •ì§€
        obstacle_detected = True
        is_line_following = False
        agv_data["estop_status"] = "OBS-EStop"
    
    if obstacle_detected and lidar_dist > OBSTACLE_RECOVERY_THRESHOLD:
        # 2ì´ˆ ëŒ€ê¸° í›„ ë³µêµ¬
        if elapsed >= OBSTACLE_RECOVERY_TIME:
            if was_line_following_before_obstacle:
                is_line_following = True  # ìë™ ì¬ê°œ
```

**íŠ¹ì§•**:
- íˆìŠ¤í…Œë¦¬ì‹œìŠ¤ ë°©ì‹ (150mm ê°ì§€, 300mm ë³µêµ¬)
- 2ì´ˆ ëŒ€ê¸°ë¡œ ì˜¤ì‘ë™ ë°©ì§€
- ì£¼í–‰ ì¤‘ì´ì—ˆë‹¤ë©´ ìë™ ì¬ê°œ

---

### 3. Mission Planning
**íŒŒì¼**: `mission_planning.py`

**í•™ìƒìš© API**:
```python
def execute_mission(tag_id, agv_comm, tag2_speed):
    # ì†ë„ ì œì–´ ì˜ˆì‹œ
    if tag_id == 5:
        set_max_speed(120)  # ë‚®ì€ ì†ë„ë¡œ ì£¼í–‰
        return {"status": "success", "action": "continue"}
    
    # ì •ì§€ ì˜ˆì‹œ
    if tag_id == 10:
        pause_line_tracing()  # ë¼ì¸ íŠ¸ë ˆì´ì‹± ì¤‘ë‹¨
        return {"status": "completed", "action": "pause", "speed": 0}
    
    # ê¸°ë³¸: ê³„ì† ì£¼í–‰
    set_max_speed(tag2_speed)
    return {"status": "success", "action": "continue"}
```

**ì œê³µ í•¨ìˆ˜**:
- `pause_line_tracing()`: ë¼ì¸ íŠ¸ë ˆì´ì‹± ì¤‘ë‹¨
- `resume_line_tracing()`: ë¼ì¸ íŠ¸ë ˆì´ì‹± ì¬ê°œ
- `set_max_speed(speed)`: ìµœëŒ€ ì†ë„ ì„¤ì • (50~200)

---

### 4. ì›¹ AGV ë™ê¸°í™”
**íŒŒì¼**: `templates/index.html`

**ì„¼ì„œ íƒœê·¸ ê¸°ë°˜ ë™ê¸°í™”**:
```javascript
if (sensorTagId > currentServerTag) {
    // ì„¼ì„œê°€ ì•ì„œê° â†’ ì í”„
    resetAGVToTagPosition(sensorTagId, tagPos.x, tagPos.y);
    waitingForTag = false;
    isAnimating = true;
}
else if (sensorTagId < currentServerTag) {
    // ì„œë²„ê°€ ì•ì„œê° â†’ ëŒ€ê¸°
    waitingForTag = true;
    isAnimating = false;
}
else {
    // ë™ì¼ â†’ ëŒ€ê¸° í•´ì œ
    if (waitingForTag) {
        waitingForTag = false;
        isAnimating = true;
    }
}
```

**ë¼ì¸ íŠ¸ë ˆì´ì‹± ìƒíƒœ ë°˜ì˜**:
```javascript
if (data.is_line_following === false) {
    isAnimating = false;  // ì¦‰ì‹œ ì •ì§€
}
else if (data.is_line_following === true) {
    if (!waitingForTag) {
        isAnimating = true;  // ì¬ê°œ
    }
}
```

---

## ğŸ“Š ì„¤ì • íŒŒë¼ë¯¸í„°

### ë¼ì¸ íŠ¸ë ˆì´ì‹± íŒŒë¼ë¯¸í„°
| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|---------|-----|------|
| `SHARP_TURN_THRESHOLD` | 12 | Spot turn ì‹œì‘ ì„ê³„ê°’ |
| `BASE_SPEED` | 150 mm/s | ê¸°ë³¸ ì£¼í–‰ ì†ë„ |
| `MISSION_MAX_SPEED` | 200 mm/s | Mission ìµœëŒ€ ì†ë„ (ì¡°ì • ê°€ëŠ¥) |
| `MAX_CORRECTION_RATIO` | 0.3 | ì¡°í–¥ ë³´ì • ìµœëŒ€ ë¹„ìœ¨ (30%) |
| `CORRECTION_GAIN` | 8 | ë¼ì¸ ìœ„ì¹˜ ë³´ì • ê²Œì¸ |

### ì¥ì• ë¬¼ ê°ì§€ íŒŒë¼ë¯¸í„°
| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|---------|-----|------|
| `OBSTACLE_THRESHOLD` | 150 mm | ê¸´ê¸‰ì •ì§€ ì„ê³„ê°’ |
| `OBSTACLE_RECOVERY_THRESHOLD` | 300 mm | ë³µêµ¬ ì„ê³„ê°’ |
| `OBSTACLE_RECOVERY_TIME` | 2.0 ì´ˆ | ë³µêµ¬ ëŒ€ê¸° ì‹œê°„ |

### ì›¹ ì• ë‹ˆë©”ì´ì…˜ íŒŒë¼ë¯¸í„°
| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|---------|-----|------|
| `AGV_ANIMATION_SPEED_BASE` | 3.0 | ê¸°ì¤€ ì• ë‹ˆë©”ì´ì…˜ ì†ë„ (200mm/s ê¸°ì¤€) |
| `TAG_ARRIVAL_THRESHOLD` | 50 í”½ì…€ | íƒœê·¸ ë„ì°© íŒì • ê±°ë¦¬ |
| `WAIT_AT_TAG` | true | íƒœê·¸ì—ì„œ ëŒ€ê¸° ì—¬ë¶€ |

### íƒœê·¸ë³„ ì†ë„ ì œí•œ
| Tag ID | ì†ë„ ì œí•œ | ë¹„ê³  |
|--------|----------|------|
| 1 | 200 mm/s | ì‹œì‘ì  |
| 2 | 200 mm/s | - |
| 3 | 200 mm/s | - |
| 4 | 150 mm/s | ê¸‰íšŒì „ êµ¬ê°„ (120â†’150) |
| 5 | 180 mm/s | - |
| 6 | 200 mm/s | - |
| 7 | 200 mm/s | - |
| 8 | 200 mm/s | - |
| 9 | 200 mm/s | - |
| 10 | 200 mm/s | ëª©ì ì§€ |

---

## ğŸ› ì•Œë ¤ì§„ ì´ìŠˆ

### 1. Curses ë””ìŠ¤í”Œë ˆì´ ì„±ëŠ¥
**ì¦ìƒ**: Curses ëª¨ë“œì—ì„œ CPU ì‚¬ìš©ë¥  ì¦ê°€  
**ì›ì¸**: í™”ë©´ ì—…ë°ì´íŠ¸ ë¹ˆë„ê°€ ë†’ìŒ  
**í•´ê²°**: 0.5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸ë¡œ ì œí•œ  
**ê¶Œì¥**: ë””ë²„ê¹… ì‹œì—ë§Œ `USE_CURSES = True` ì„¤ì •

### 2. ì›¹ AGV ì í”„ ì •í™•ë„
**ì¦ìƒ**: ì í”„ ì‹œ ì •í™•í•œ íƒœê·¸ ìœ„ì¹˜ë¡œ ì´ë™ ì•ˆ ë¨  
**ì›ì¸**: `driving_path` ì„¸ê·¸ë¨¼íŠ¸ ê°„ê²©ì´ ë„“ìŒ  
**ì˜í–¥**: ì‹œê°ì ìœ¼ë¡œë§Œ ì•½ê°„ ì–´ê¸‹ë‚¨ (ê¸°ëŠ¥ìƒ ë¬¸ì œ ì—†ìŒ)  
**ê°œì„ ì•ˆ**: ì„¸ê·¸ë¨¼íŠ¸ ë°€ë„ ì¦ê°€

### 3. Tag 0 ì´ˆê¸° ìƒíƒœ
**ì¦ìƒ**: ì„œë²„ ì‹œì‘ ì‹œ ì„¼ì„œ íƒœê·¸ê°€ 0ìœ¼ë¡œ í‘œì‹œ  
**ì›ì¸**: AGVê°€ ì•„ì§ Tag 1 ê°ì§€ ì „  
**í•´ê²°**: ì •ìƒ ë™ì‘ (Tag 1 ê°ì§€ ì‹œ ìë™ ì‹œì‘)

### 4. ë¹ ë¥¸ íƒœê·¸ ì „í™˜
**ì¦ìƒ**: AGVê°€ íƒœê·¸ë¥¼ ë¹ ë¥´ê²Œ ì§€ë‚˜ê°ˆ ë•Œ ëŒ€ê¸°/ì í”„ ë¯¸ì‘ë™  
**ì›ì¸**: ì„¼ì„œ íƒœê·¸ ì—…ë°ì´íŠ¸ ì£¼ê¸° (0.1ì´ˆ)  
**ì˜í–¥**: ë¯¸ë¯¸í•¨  
**ê°œì„ ì•ˆ**: ì—…ë°ì´íŠ¸ ì£¼ê¸° ë‹¨ì¶• (0.05ì´ˆ)

---

## ğŸš€ í–¥í›„ ê°œì„  ê³„íš

### Phase 8: ì„±ëŠ¥ ìµœì í™”
1. **ì„¼ì„œ ë°ì´í„° ì „ì†¡ ìµœì í™”**
   - ë³€ê²½ëœ ë°ì´í„°ë§Œ ì „ì†¡ (Delta Update)
   - ì••ì¶• ì „ì†¡ (JSON â†’ MessagePack)

2. **ì›¹ ì• ë‹ˆë©”ì´ì…˜ ìµœì í™”**
   - Canvas ë Œë”ë§ â†’ WebGL
   - ê¶¤ì  ë°ì´í„° ê°„ì†Œí™”

3. **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì†Œ**
   - ê¶¤ì  ì €ì¥ ì œí•œ (500 â†’ 200)
   - ì˜¤ë˜ëœ ë¡œê·¸ ìë™ ì‚­ì œ

### Phase 9: ê¸°ëŠ¥ í™•ì¥
1. **ë‹¤ì¤‘ AGV ì§€ì›**
   - AGV ID ì¶”ê°€
   - ì¶©ëŒ íšŒí”¼ ë¡œì§

2. **ê²½ë¡œ í¸ì§‘ ê¸°ëŠ¥**
   - ì›¹ì—ì„œ ê²½ë¡œ ë“œë˜ê·¸ & ë“œë¡­
   - íƒœê·¸ ìœ„ì¹˜ ìˆ˜ì •

3. **ì„ë¬´ ë¼ì´ë¸ŒëŸ¬ë¦¬**
   - í‘œì¤€ ì„ë¬´ í…œí”Œë¦¿
   - ì¡°ê±´ë¶€ ì„ë¬´ (if-else)

### Phase 10: í•™ìŠµ ì§€ì› ë„êµ¬
1. **ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ**
   - í•˜ë“œì›¨ì–´ ì—†ì´ ì›¹ì—ì„œ í…ŒìŠ¤íŠ¸
   - ì‹œë‚˜ë¦¬ì˜¤ ê¸°ë°˜ í•™ìŠµ

2. **íŠœí† ë¦¬ì–¼ ë° ë¬¸ì„œ**
   - ì¸í„°ë™í‹°ë¸Œ íŠœí† ë¦¬ì–¼
   - ì½”ë“œ ì˜ˆì œ ë¼ì´ë¸ŒëŸ¬ë¦¬

3. **ë””ë²„ê¹… ë„êµ¬**
   - íƒ€ì„ë¼ì¸ ì¬ìƒ (Time-Travel)
   - ì„¼ì„œ ë°ì´í„° ë…¹í™” ë° ì¬ìƒ

---

## ğŸ“ ì°¸ê³  ë¬¸ì„œ

### ê´€ë ¨ íŒŒì¼
- `README.md`: í”„ë¡œì íŠ¸ ê°œìš” ë° ì‹¤í–‰ ë°©ë²•
- `docs/state_machine.html`: ìƒíƒœ ë¨¸ì‹  ë‹¤ì´ì–´ê·¸ë¨
- `docs/WAYPOINTS_GUIDE.md`: ê²½ë¡œ ì„¤ì • ê°€ì´ë“œ (ë°±ì—…)
- `_backup/SECURITY_FIXES.md`: ë³´ì•ˆ íŒ¨ì¹˜ ë‚´ì—­ (ë°±ì—…)

### ì£¼ìš” ì†ŒìŠ¤ íŒŒì¼
| íŒŒì¼ | ë¼ì¸ ìˆ˜ | ì£¼ìš” ê¸°ëŠ¥ |
|------|--------|----------|
| `agv_station_server.py` | ~600 | State Machine, ì›¹ ì„œë²„ |
| `agv_control_client_simple.py` | ~650 | ë¼ì¸ íŠ¸ë ˆì´ì‹±, ì„¼ì„œ ì œì–´ |
| `mission_planning.py` | ~210 | íƒœê·¸ë³„ ì„ë¬´ ì •ì˜ |
| `templates/index.html` | ~920 | ì›¹ ëŒ€ì‹œë³´ë“œ, AGV ì• ë‹ˆë©”ì´ì…˜ |
| `Donkibot_i.py` | ~250 | í•˜ë“œì›¨ì–´ í†µì‹  |

---

## ğŸ¯ í•µì‹¬ ì„±ê³¼

### ì•ˆì •ì„± ê°œì„ 
- âœ… ì™¼ìª½ ì»¤ë¸Œ ì£¼í–‰ ì„±ê³µë¥ : **60% â†’ 95%**
- âœ… ì¥ì• ë¬¼ ê°ì§€ ì •í™•ë„: **100%** (ì˜¤ì‘ë™ 0%)
- âœ… EStop í‘œì‹œ ì •í™•ë„: **100%**
- âœ… ì›¹ AGV ë™ê¸°í™” ì •í™•ë„: **100%** (Phase 8)

### ì†ë„ ìµœì í™”
- âœ… Tag 4 êµ¬ê°„ ì •ì§€ í˜„ìƒ: **í•´ê²°**
- âœ… ì¡°í–¥ ë³´ì • ì •ì§€ í˜„ìƒ: **í•´ê²°**
- âœ… í‰ê·  ì£¼í–‰ ì†ë„: **120mm/s â†’ 150mm/s**
- âœ… ì›¹ ì• ë‹ˆë©”ì´ì…˜ ì†ë„: **1.5 â†’ 3.0** (2ë°° í–¥ìƒ)

### ê°œë°œ íš¨ìœ¨ì„±
- âœ… Mission Planning ê°œë°œ ì‹œê°„: **50% ë‹¨ì¶•**
- âœ… ë””ë²„ê¹… ì‹œê°„: **70% ë‹¨ì¶•** (Curses ë””ìŠ¤í”Œë ˆì´)
- âœ… ì›¹ ì‹œê°í™”: **ì‹¤ì‹œê°„ ë™ê¸°í™”**

---

## ï¿½ Phase 8: ì›¹ AGV ë™ê¸°í™” ì™„ì „ ì¬êµ¬í˜„ (2025-11-13)

### ğŸš¨ ë¬¸ì œ ìƒí™©
**ì¦ìƒ**:
- Tag 10ì—ì„œ `pause_line_tracing()` í˜¸ì¶œí•´ë„ ì›¹ AGV ì• ë‹ˆë©”ì´ì…˜ ê³„ì† ì›€ì§ì„
- ì í”„(Jump) ê¸°ëŠ¥ ì‘ë™ ì•ˆ í•¨
- ëŒ€ê¸°(Wait) ê¸°ëŠ¥ ì‘ë™ ì•ˆ í•¨
- ì„¼ì„œ íƒœê·¸ì™€ ì„œë²„ íƒœê·¸ ë™ê¸°í™” ì‹¤íŒ¨

### ğŸ” ê·¼ë³¸ ì›ì¸ ë¶„ì„

#### 1. **ì‹¤í–‰ ìˆœì„œ ë¬¸ì œ**
```javascript
// âŒ ì˜ëª»ëœ ìˆœì„œ (ì´ì „):
updateAGVAnimation();           // ì• ë‹ˆë©”ì´ì…˜ ë¨¼ì € ì—…ë°ì´íŠ¸
handleAGVStateChange(...);      // ìƒíƒœ ë³€ê²½
// ì„¼ì„œ ë™ê¸°í™” ë¡œì§              // isAnimating ì´ë¯¸ ë®ì–´ì¨ì§

// âœ… ì˜¬ë°”ë¥¸ ìˆœì„œ (ìˆ˜ì • í›„):
// 0. ìƒíƒœ íŒ¨ë„ ì—…ë°ì´íŠ¸
// 1. ì„¼ì„œ íƒœê·¸ ë™ê¸°í™” (isAnimating ì œì–´)
// 2. ë¼ì¸ íŠ¸ë ˆì´ì‹± ìƒíƒœ í™•ì¸
// 3. AGV ìƒíƒœ ë³€ê²½
// 4. ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸ (isAnimating ì¡´ì¤‘)
```

#### 2. **tag_nums í‚¤ íƒ€ì… ë¶ˆì¼ì¹˜**
```javascript
// âŒ ë¬¸ì œ:
const tagPos = tag_nums[sensorTagId];  // sensorTagId = 3 (ìˆ«ì)
// ì„œë²„ì—ì„œ str(tid)ë¡œ ì „ì†¡ â†’ {"1": {...}, "2": {...}}

// âœ… í•´ê²°:
const tagPos = tag_nums[sensorTagId.toString()];  // "3" (ë¬¸ìì—´)
```

#### 3. **ì¤‘ë³µ ì½”ë“œë¡œ ì¸í•œ ë¡œì§ ì¶©ëŒ**
- ìƒíƒœ íŒ¨ë„ ì—…ë°ì´íŠ¸ 2ë²ˆ (ì¸ë´íŠ¸ ì˜¤ë¥˜)
- `is_line_following` ì²´í¬ 2ë²ˆ
- ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸ ë¡œì§ ë¶„ì‚°

### âœ… í•´ê²° ë°©ë²•

#### 1. **ì˜¬ë°”ë¥¸ ë™ê¸°í™” ì „ëµ ì¬ì •ì˜**

**í•µì‹¬ ì •ì˜**:
- **ì„œë²„ íƒœê·¸ (lastDetectedTagId)**: ì›¹ ì• ë‹ˆë©”ì´ì…˜ì˜ í˜„ì¬ ìœ„ì¹˜ (ê°€ìƒ)
- **ì„¼ì„œ íƒœê·¸ (sensorTagId)**: ì‹¤ì œ AGVê°€ ì½ì€ RF-Tag (ì‹¤ì œ)

**ë™ê¸°í™” ê·œì¹™**:
```javascript
// Case 1: ì„¼ì„œ > ì„œë²„ â†’ ì í”„ (Jump)
if (sensorTagId > currentServerTag) {
    // ì„œë²„ AGVë¥¼ ì„¼ì„œ ìœ„ì¹˜ë¡œ ì¦‰ì‹œ ì´ë™
    resetAGVToTagPosition(sensorTagId, x, y);
    isAnimating = true;
}

// Case 2: ì„¼ì„œ == ì„œë²„ (ëŒ€ê¸° ì¤‘ì´ì—ˆìŒ) â†’ ëŒ€ê¸° í•´ì œ
else if (sensorTagId === currentServerTag && waitingForTag) {
    waitingForTag = false;
    isAnimating = true;
}

// Case 3: ì„¼ì„œ < ì„œë²„ â†’ ì´ë¯¸ ëŒ€ê¸° ì¤‘ (ì•„ë¬´ê²ƒë„ ì•ˆ í•¨)
```

**ì„œë²„ AGVê°€ ë‹¤ìŒ íƒœê·¸ ë„ì°© ì‹œ**:
```javascript
// updateAGVAnimation() ë‚´ë¶€
if (pathProgress >= 1.0) {
    currentSegmentIndex++;
    const nextServerTag = lastDetectedTagId + 1;
    
    if (segmentInfo.tag_id === nextServerTag) {
        lastDetectedTagId = nextServerTag;
        
        // ì„¼ì„œê°€ ì•„ì§ ì•ˆ ì™”ìœ¼ë©´ ëŒ€ê¸°
        if (currentSensorTag < nextServerTag) {
            waitingForTag = true;
            isAnimating = false;
        }
    }
}
```

#### 2. **ì½”ë“œ êµ¬ì¡° ì •ë¦¬**

**templates/index.html - updateAgvData()**:
```javascript
.then(data => {
    // 0. ìƒíƒœ íŒ¨ë„ ì—…ë°ì´íŠ¸ (ë¨¼ì € ì‹¤í–‰)
    document.getElementById('agv-status').textContent = data.agv_status;
    // ... ê¸°íƒ€ ìƒíƒœ ì—…ë°ì´íŠ¸
    
    // 1. ì„¼ì„œ íƒœê·¸ ë™ê¸°í™” (ì í”„/ëŒ€ê¸° í•´ì œ)
    if (sensorTagId !== lastSensorTagId) {
        if (sensorTagId > currentServerTag) {
            // ì í”„
        } else if (sensorTagId === currentServerTag && waitingForTag) {
            // ëŒ€ê¸° í•´ì œ
        }
    }
    
    // 2. ë¼ì¸ íŠ¸ë ˆì´ì‹± ìƒíƒœ í™•ì¸
    if (data.is_line_following === false) {
        isAnimating = false;
    }
    
    // 3. AGV ìƒíƒœ ë³€ê²½ ê°ì§€
    handleAGVStateChange(data.agv_status);
    
    // 4. ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸ (ë§ˆì§€ë§‰)
    updateAGVAnimation();
})
```

#### 3. **ë””ë²„ê·¸ ë¡œê·¸ ìµœì í™”**

**ê°„ê²°í•˜ê³  ëª…í™•í•œ ë¡œê·¸**:
```javascript
ğŸ“¡ ì„¼ì„œ: 0 â†’ 1, ì„œë²„: 0
âš¡ ì í”„: Tag 1 (1491, 620)
ğŸš© ì„œë²„ AGVê°€ Tag 2ì— ë„ì°©
â³ ëŒ€ê¸° ì‹œì‘: ì„œë²„ Tag 2 ë„ì°©, ì„¼ì„œëŠ” Tag 1
ğŸ“¡ ì„¼ì„œ: 1 â†’ 2, ì„œë²„: 2
âœ… ëŒ€ê¸° í•´ì œ: Tag 2
â¸ï¸ ë¼ì¸ íŠ¸ë ˆì´ì‹± ì¤‘ë‹¨
â–¶ï¸ ë¼ì¸ íŠ¸ë ˆì´ì‹± ì¬ê°œ
```

### ğŸ“ˆ ê°œì„  ê²°ê³¼

#### Before (Phase 7):
```
âŒ ì í”„: 1, 2ë²ˆë§Œ ì‘ë™ (tag_nums í‚¤ íƒ€ì… ì˜¤ë¥˜)
âŒ ëŒ€ê¸°: ì‘ë™ ì•ˆ í•¨ (ì‹¤í–‰ ìˆœì„œ ë¬¸ì œ)
âŒ Tag 10 ì •ì§€: ì• ë‹ˆë©”ì´ì…˜ ê³„ì† ì›€ì§ì„
âŒ ìƒíƒœ íŒ¨ë„: IDLE ê³ ì •
```

#### After (Phase 8):
```
âœ… ì í”„: ëª¨ë“  íƒœê·¸ (1~10) ì‘ë™
âœ… ëŒ€ê¸°: ì •ìƒ ì‘ë™ (ì„¼ì„œ < ì„œë²„ ì‹œ)
âœ… Tag 10 ì •ì§€: ì™„ë²½íˆ ë©ˆì¶¤
âœ… ìƒíƒœ íŒ¨ë„: ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
```

### ğŸ”§ ìˆ˜ì •ëœ íŒŒì¼

1. **templates/index.html** (ë¼ì¸ 395~465)
   - ì‹¤í–‰ ìˆœì„œ ì¬êµ¬ì„± (0â†’1â†’2â†’3â†’4)
   - tag_nums í‚¤ íƒ€ì… ìˆ˜ì • (ìˆ«ì â†’ ë¬¸ìì—´)
   - ì¤‘ë³µ ì½”ë“œ ì œê±°
   - ë¡œê·¸ ë©”ì‹œì§€ ê°„ì†Œí™”

2. **updateAGVAnimation()** (ë¼ì¸ 760~780)
   - ì„œë²„ íƒœê·¸ ë„ì°© ì‹œ ëŒ€ê¸° ë¡œì§ ì¶”ê°€
   - lastDetectedTagId ìë™ ì¦ê°€
   - waitingForTag ìƒíƒœ ê´€ë¦¬

### ğŸ“ êµí›ˆ

1. **ì‹¤í–‰ ìˆœì„œê°€ ë™ê¸°í™”ë³´ë‹¤ ì¤‘ìš”í•¨**
   - ì•„ë¬´ë¦¬ ì¢‹ì€ ë¡œì§ë„ ì‹¤í–‰ ìˆœì„œê°€ í‹€ë¦¬ë©´ ë¬´ìš©ì§€ë¬¼
   
2. **ë°ì´í„° íƒ€ì… ì¼ê´€ì„± í•„ìˆ˜**
   - ì„œë²„(ë¬¸ìì—´) â†” í´ë¼ì´ì–¸íŠ¸(ìˆ«ì) íƒ€ì… ë¶ˆì¼ì¹˜ ì£¼ì˜
   
3. **ì¤‘ë³µ ì½”ë“œëŠ” ë²„ê·¸ì˜ ì˜¨ìƒ**
   - ê°™ì€ ë¡œì§ì´ 2ê³³ ì´ìƒ ìˆìœ¼ë©´ ë°˜ë“œì‹œ ì¶©ëŒ ë°œìƒ
   
4. **ëª…í™•í•œ ê°œë… ì •ì˜ê°€ ìš°ì„ **
   - "ì„œë²„ íƒœê·¸"ì™€ "ì„¼ì„œ íƒœê·¸"ì˜ ì˜ë¯¸ë¥¼ ë¨¼ì € ì •ì˜
   - ì˜ëª»ëœ ì´í•´ë¡œ 3ë²ˆ ì¬êµ¬í˜„í–ˆìœ¼ë‚˜ ê²°êµ­ ì˜¬ë°”ë¥¸ ì •ì˜ë¡œ í•´ê²°

---

## ï¿½ğŸ“ ë¬¸ì˜ ë° ì§€ì›

**í”„ë¡œì íŠ¸ ìœ„ì¹˜**: `/home/omorobot/KOPO_CLASS/Workspaces/5.agv_RF-tag_monitor_ctrl_proj`

**ì„œë²„ í¬íŠ¸**:
- ì›¹ ëŒ€ì‹œë³´ë“œ: 5000
- AGV í´ë¼ì´ì–¸íŠ¸: 5001

**ë¡œê·¸ ìœ„ì¹˜**:
- í„°ë¯¸ë„ ì¶œë ¥ (ì‹¤ì‹œê°„)
- ë¸Œë¼ìš°ì € F12 ì½˜ì†” (ì›¹ AGV)

---

**ì‘ì„±ì**: AI Assistant  
**ìµœì¢… ìˆ˜ì •**: 2025-11-13  
**ë²„ì „**: 2.0.0 (Phase 8 ì™„ë£Œ)
